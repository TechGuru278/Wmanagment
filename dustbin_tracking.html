<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Waste Management Tracker | Binify ECO Route</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2f1a, #2d5a2d, #3a7c3a);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        .background-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bubble {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 15s infinite ease-in-out;
        }

        .leaf {
            position: absolute;
            font-size: 24px;
            color: rgba(139, 195, 74, 0.5);
            animation: fall 20s infinite linear;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        @keyframes fall {
            0% { transform: translateY(-100px) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(360deg); }
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            animation: fadeIn 1s ease;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 15px rgba(139, 195, 74, 0.5);
        }

        .logo i {
            font-size: 24px;
            color: #4caf50;
        }

        .logo-text h1 {
            font-size: 2rem;
            background: linear-gradient(to right, #8bc34a, #4caf50, #2e7d32);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .logo-text p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .back-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .page-header {
            text-align: center;
            padding: 40px 0;
            animation: slideUp 1s ease;
        }

        .page-header h2 {
            font-size: 3rem;
            margin-bottom: 20px;
            text-shadow: 0 0 15px rgba(139, 195, 74, 0.7);
        }

        .page-header p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .tracking-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin: 40px 0;
            height: 600px;
        }

        @media (max-width: 968px) {
            .tracking-container {
                grid-template-columns: 1fr;
                height: auto;
            }
        }

        .map-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            animation: fadeIn 1s ease;
            position: relative;
            overflow: hidden;
        }

        #map {
            width: 100%;
            height: 100%;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        }

        .info-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            animation: fadeIn 1s ease;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .location-info {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .location-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .location-header i {
            font-size: 24px;
            color: #4caf50;
        }

        .location-details p {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .gps-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .gps-status i {
            font-size: 20px;
            color: #4caf50;
        }

        .gps-status .loading {
            color: #FF9800;
            animation: pulse 1.5s infinite;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .primary-btn {
            background: #4caf50;
            color: white;
        }

        .primary-btn:hover {
            background: #3d8b40;
            transform: translateY(-2px);
        }

        .secondary-btn {
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }

        .secondary-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .locations-list {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .location-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .location-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
        }

        .location-card.active {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.5);
        }

        .location-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .location-name {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .location-distance-badge {
            background: rgba(139, 195, 74, 0.2);
            color: #8bc34a;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .location-details {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .location-type {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 8px;
        }

        .type-dustbin {
            background: rgba(255, 152, 0, 0.2);
            color: #FF9800;
        }

        .type-recycling {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }

        .type-center {
            background: rgba(156, 39, 176, 0.2);
            color: #9C27B0;
        }

        .type-compost {
            background: rgba(121, 85, 72, 0.2);
            color: #795548;
        }

        .location-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 5px;
        }

        .status-available {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }

        .status-full {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }

        .status-maintenance {
            background: rgba(255, 152, 0, 0.2);
            color: #FF9800;
        }

        .loading-indicator {
            display: none;
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            margin-top: 20px;
        }

        .loading-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #8bc34a;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            font-size: 1.1rem;
            color: #8bc34a;
            font-weight: 600;
        }

        .loading-dots {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .loading-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #8bc34a;
            animation: pulse 1.5s infinite ease-in-out;
        }

        .loading-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .loading-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }

        footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 50px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .footer-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .footer-logo .logo {
            width: 30px;
            height: 30px;
        }

        .footer-logo span {
            font-size: 1.2rem;
            font-weight: 600;
            background: linear-gradient(to right, #8bc34a, #4caf50);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a2f1a, #2d5a2d);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .map-error {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 20px;
        }

        .map-error i {
            font-size: 3rem;
            color: #f44336;
            margin-bottom: 20px;
        }

        .map-error h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .map-error p {
            margin-bottom: 20px;
            opacity: 0.8;
        }

        .filter-section {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .filter-section h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .filter-btn {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 20px;
            color: white;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: #4caf50;
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 10px 15px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-weight: 600;
            font-size: 1.1rem;
            color: #8bc34a;
        }

        .stat-label {
            font-size: 0.7rem;
            opacity: 0.8;
        }

        .error-message {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            border-radius: 10px;
            padding: 10px 15px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .success-message {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4CAF50;
            border-radius: 10px;
            padding: 10px 15px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .warning-message {
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid #FF9800;
            border-radius: 10px;
            padding: 10px 15px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
    </style>
</head>

<body>
    <div class="background-animation" id="backgroundAnimation"></div>

    <div class="container">
        <header>
            <div class="logo-container">
                <div class="logo">
                    <i class="fas fa-recycle"></i>
                </div>
                <div class="logo-text">
                    <h1>Binify ECO Route</h1>
                    <p>Smart Waste Management for Indian Cities</p>
                </div>
            </div>
            <a href="home.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> Back to Home
            </a>
        </header>

        <section class="page-header">
            <h2>Indian Waste Management Tracker</h2>
            <p>Find waste disposal points, recycling centers, and dustbins across major Indian cities using real data.</p>
        </section>

        <div class="tracking-container">
            <div class="map-section">
                <div id="map"></div>
            </div>

            <div class="info-section">
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-value" id="totalFacilities">42</div>
                        <div class="stat-label">Total Facilities</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="citiesCount">8</div>
                        <div class="stat-label">Cities</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="nearbyFacilities">0</div>
                        <div class="stat-label">Near You</div>
                    </div>
                </div>

                <div class="gps-status" id="gpsStatus">
                    <i class="fas fa-satellite-dish loading"></i>
                    <span>Detecting your location...</span>
                </div>

                <div id="statusMessage"></div>

                <div class="location-info" id="locationInfo">
                    <div class="location-header">
                        <i class="fas fa-map-marker-alt"></i>
                        <h3>Your Location</h3>
                    </div>
                    <div class="location-details">
                        <p><i class="fas fa-clock"></i> <span id="locationTime">--:--:--</span></p>
                        <p><i class="fas fa-satellite"></i> <span id="coordinates">Lat: --, Lng: --</span></p>
                        <p><i class="fas fa-city"></i> <span id="cityName">Default Location (ATME College)</span></p>
                    </div>
                </div>

                <div class="filter-section">
                    <h3><i class="fas fa-filter"></i> Filter by Waste Type</h3>
                    <div class="filter-options">
                        <button class="filter-btn active" data-type="all">All</button>
                        <button class="filter-btn" data-type="Plastic">Plastic</button>
                        <button class="filter-btn" data-type="Organic">Organic</button>
                        <button class="filter-btn" data-type="E-Waste">E-Waste</button>
                        <button class="filter-btn" data-type="Construction">Construction</button>
                        <button class="filter-btn" data-type="Hazardous">Hazardous</button>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="action-btn primary-btn" id="refreshLocationBtn">
                        <i class="fas fa-sync-alt"></i> Refresh Location
                    </button>
                    <button class="action-btn secondary-btn" id="findNearestBtn">
                        <i class="fas fa-search"></i> Find Nearest
                    </button>
                </div>

                <div class="loading-indicator" id="loadingIndicator">
                    <div class="loading-content">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">Finding Waste Facilities</div>
                        <div class="loading-dots">
                            <div class="loading-dot"></div>
                            <div class="loading-dot"></div>
                            <div class="loading-dot"></div>
                        </div>
                        <p>Scanning your area for waste disposal points...</p>
                    </div>
                </div>

                <div class="locations-list" id="locationsList">
                    <!-- Location cards will be populated by JavaScript -->
                    <div class="location-card">
                        <div class="location-card-header">
                            <div class="location-name">
                                <i class="fas fa-info-circle"></i>
                                Enable Location Services
                            </div>
                        </div>
                        <div class="location-details">
                            Please allow location access to find nearby waste facilities. Using default location for now.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <div class="footer-content">
                <div class="footer-logo">
                    <div class="logo">
                        <i class="fas fa-recycle"></i>
                    </div>
                    <span>Binify ECO Route</span>
                </div>
                <p>&copy; 2023 Binify ECO Route Waste Management Solutions. All rights reserved.</p>
                <p style="font-size: 0.8rem; opacity: 0.7;">Data based on Waste Management and Recycling India dataset</p>
            </div>
        </footer>
    </div>

    <!-- Google Maps API -->
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCXZpS4nDKWmSBVEM6nueU1_XyX-lgoKuc&callback=initMap&libraries=geometry"
        async defer></script>

    <script>
        // Dummy dataset based on the provided example with "Dustbin" instead of "Landfill"
        const wasteManagementData = [
            // Mumbai data
            { City: "Mumbai", WasteType: "Plastic", WasteGenerated: 6610, RecyclingRate: 68, PopulationDensity: 11191, MunicipalEfficiency: 9, DisposalMethod: "Composting", Cost: 3056, AwarenessCampaigns: 14, LandfillName: "Mumbai Central Dustbin", Latitude: 19.0760, Longitude: 72.8777, LandfillCapacity: 45575, Year: 2019 },
            { City: "Mumbai", WasteType: "Organic", WasteGenerated: 1181, RecyclingRate: 56, PopulationDensity: 11191, MunicipalEfficiency: 5, DisposalMethod: "Composting", Cost: 2778, AwarenessCampaigns: 12, LandfillName: "Mumbai South Dustbin", Latitude: 19.0860, Longitude: 72.8877, LandfillCapacity: 45575, Year: 2019 },
            { City: "Mumbai", WasteType: "E-Waste", WasteGenerated: 8162, RecyclingRate: 53, PopulationDensity: 11191, MunicipalEfficiency: 8, DisposalMethod: "Incineration", Cost: 3390, AwarenessCampaigns: 13, LandfillName: "Mumbai West Dustbin", Latitude: 19.0660, Longitude: 72.8677, LandfillCapacity: 45575, Year: 2019 },
            { City: "Mumbai", WasteType: "Construction", WasteGenerated: 8929, RecyclingRate: 56, PopulationDensity: 11191, MunicipalEfficiency: 5, DisposalMethod: "Landfill", Cost: 1498, AwarenessCampaigns: 14, LandfillName: "Mumbai North Dustbin", Latitude: 19.0960, Longitude: 72.8477, LandfillCapacity: 45575, Year: 2019 },
            { City: "Mumbai", WasteType: "Hazardous", WasteGenerated: 5032, RecyclingRate: 44, PopulationDensity: 11191, MunicipalEfficiency: 7, DisposalMethod: "Recycling", Cost: 2221, AwarenessCampaigns: 16, LandfillName: "Mumbai East Dustbin", Latitude: 19.0760, Longitude: 72.8977, LandfillCapacity: 45575, Year: 2019 },

            // Delhi data
            { City: "Delhi", WasteType: "Plastic", WasteGenerated: 5820, RecyclingRate: 62, PopulationDensity: 11320, MunicipalEfficiency: 8, DisposalMethod: "Recycling", Cost: 2980, AwarenessCampaigns: 18, LandfillName: "Delhi Central Dustbin", Latitude: 28.6139, Longitude: 77.2090, LandfillCapacity: 52000, Year: 2019 },
            { City: "Delhi", WasteType: "Organic", WasteGenerated: 3250, RecyclingRate: 48, PopulationDensity: 11320, MunicipalEfficiency: 6, DisposalMethod: "Composting", Cost: 2450, AwarenessCampaigns: 15, LandfillName: "Delhi South Dustbin", Latitude: 28.6039, Longitude: 77.1990, LandfillCapacity: 52000, Year: 2019 },

            // Bangalore data
            { City: "Bangalore", WasteType: "Plastic", WasteGenerated: 4200, RecyclingRate: 65, PopulationDensity: 10854, MunicipalEfficiency: 8, DisposalMethod: "Recycling", Cost: 2750, AwarenessCampaigns: 16, LandfillName: "Bangalore Central Dustbin", Latitude: 12.9716, Longitude: 77.5946, LandfillCapacity: 38500, Year: 2019 },
            { City: "Bangalore", WasteType: "Organic", WasteGenerated: 2800, RecyclingRate: 55, PopulationDensity: 10854, MunicipalEfficiency: 7, DisposalMethod: "Composting", Cost: 2200, AwarenessCampaigns: 13, LandfillName: "Bangalore South Dustbin", Latitude: 12.9616, Longitude: 77.5846, LandfillCapacity: 38500, Year: 2019 },

            // Chennai data
            { City: "Chennai", WasteType: "Plastic", WasteGenerated: 3800, RecyclingRate: 58, PopulationDensity: 10687, MunicipalEfficiency: 7, DisposalMethod: "Recycling", Cost: 2650, AwarenessCampaigns: 14, LandfillName: "Chennai Central Dustbin", Latitude: 13.0827, Longitude: 80.2707, LandfillCapacity: 42000, Year: 2019 },
            { City: "Chennai", WasteType: "Organic", WasteGenerated: 2400, RecyclingRate: 52, PopulationDensity: 10687, MunicipalEfficiency: 6, DisposalMethod: "Composting", Cost: 2100, AwarenessCampaigns: 12, LandfillName: "Chennai South Dustbin", Latitude: 13.0727, Longitude: 80.2607, LandfillCapacity: 42000, Year: 2019 },

            // Kolkata data
            { City: "Kolkata", WasteType: "Plastic", WasteGenerated: 3500, RecyclingRate: 54, PopulationDensity: 10467, MunicipalEfficiency: 6, DisposalMethod: "Recycling", Cost: 2550, AwarenessCampaigns: 13, LandfillName: "Kolkata Central Dustbin", Latitude: 22.5726, Longitude: 88.3639, LandfillCapacity: 39500, Year: 2019 },

            // Hyderabad data
            { City: "Hyderabad", WasteType: "Plastic", WasteGenerated: 3200, RecyclingRate: 61, PopulationDensity: 10234, MunicipalEfficiency: 7, DisposalMethod: "Recycling", Cost: 2450, AwarenessCampaigns: 15, LandfillName: "Hyderabad Central Dustbin", Latitude: 17.3850, Longitude: 78.4867, LandfillCapacity: 36500, Year: 2019 },

            // Ahmedabad data
            { City: "Ahmedabad", WasteType: "Plastic", WasteGenerated: 2800, RecyclingRate: 59, PopulationDensity: 9876, MunicipalEfficiency: 7, DisposalMethod: "Recycling", Cost: 2350, AwarenessCampaigns: 14, LandfillName: "Ahmedabad Central Dustbin", Latitude: 23.0225, Longitude: 72.5714, LandfillCapacity: 34000, Year: 2019 },

            // Pune data
            { City: "Pune", WasteType: "Plastic", WasteGenerated: 2500, RecyclingRate: 63, PopulationDensity: 9456, MunicipalEfficiency: 8, DisposalMethod: "Recycling", Cost: 2250, AwarenessCampaigns: 16, LandfillName: "Pune Central Dustbin", Latitude: 18.5204, Longitude: 73.8567, LandfillCapacity: 31500, Year: 2019 },

            // Mysore data
            { City: "Mysore", WasteType: "Plastic", WasteGenerated: 1800, RecyclingRate: 59, PopulationDensity: 7600, MunicipalEfficiency: 7, DisposalMethod: "Recycling", Cost: 2100, AwarenessCampaigns: 14, LandfillName: "Mysore Central Dustbin", Latitude: 12.2958, Longitude: 76.6394, LandfillCapacity: 24800, Year: 2019 },
            { City: "Mysore", WasteType: "Organic", WasteGenerated: 2200, RecyclingRate: 68, PopulationDensity: 7600, MunicipalEfficiency: 8, DisposalMethod: "Composting", Cost: 1650, AwarenessCampaigns: 17, LandfillName: "Mysore South Dustbin", Latitude: 12.2858, Longitude: 76.6294, LandfillCapacity: 24800, Year: 2019 },

            // ATME College of Engineering data
            { City: "Mysore", Institution: "ATME College of Engineering", WasteType: "Plastic", WasteGenerated: 45, RecyclingRate: 72, PopulationDensity: 3200, MunicipalEfficiency: 9, DisposalMethod: "Recycling", Cost: 1900, AwarenessCampaigns: 8, LandfillName: "ATME Campus Dustbin", Latitude: 12.3145, Longitude: 76.7709, LandfillCapacity: 850, Year: 2019 },
            { City: "Mysore", Institution: "ATME College of Engineering", WasteType: "Organic", WasteGenerated: 65, RecyclingRate: 78, PopulationDensity: 3200, MunicipalEfficiency: 9, DisposalMethod: "Composting", Cost: 1300, AwarenessCampaigns: 9, LandfillName: "ATME Campus Composting Facility", Latitude: 12.3245, Longitude: 76.7614, LandfillCapacity: 850, Year: 2019 },
            { City: "Mysore", Institution: "ATME College of Engineering", WasteType: "E-Waste", WasteGenerated: 10, RecyclingRate: 70, PopulationDensity: 3200, MunicipalEfficiency: 10, DisposalMethod: "Authorized Collection", Cost: 2200, AwarenessCampaigns: 6, LandfillName: "ATME E-Waste Collection", Latitude: 12.3142, Longitude: 76.7810, LandfillCapacity: 850, Year: 2019 }
        ];

        // Default location (ATME College)
        const defaultLocation = { 
            lat: 12.3145, 
            lng: 76.7709, 
            name: "ATME College of Engineering, Mysore" 
        };

        // Global variables
        let map;
        let userMarker;
        let userLocation = null;
        let facilityMarkers = [];
        let infoWindow;
        let mapError = false;
        let currentFilter = "all";
        let geolocationWatchId = null;

        // Initialize the map
        function initMap() {
            console.log("Initializing map...");
            
            // Use default location as initial center
            const initialCenter = defaultLocation;

            try {
                // Create map with better error handling
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 12,
                    center: initialCenter,
                    mapTypeControl: true,
                    streetViewControl: false,
                    fullscreenControl: true,
                    zoomControl: true,
                    styles: [
                        {
                            "featureType": "poi",
                            "stylers": [{ "visibility": "off" }]
                        }
                    ]
                });

                console.log("Map created successfully");
                
                // Create info window
                infoWindow = new google.maps.InfoWindow();

                // Add default location marker
                addUserMarker(initialCenter, "Default Location (ATME College)");
                userLocation = initialCenter;
                
                // Show all facilities initially
                setTimeout(() => {
                    showAllFacilities();
                    updateLocationDisplay(initialCenter, "Default Location (ATME College)");
                    showStatusMessage("Using default location: ATME College of Engineering, Mysore", "info");
                }, 500);

                // Try to get user's location with a timeout
                getUserLocation();

            } catch (error) {
                console.error("Error initializing map:", error);
                showMapError("Failed to initialize map. Please check your internet connection.");
            }
        }

        // Show map error message
        function showMapError(message = "We're having trouble loading the map.") {
            mapError = true;
            const mapElement = document.getElementById('map');
            mapElement.innerHTML = `
                <div class="map-error">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Map Loading Error</h3>
                    <p>${message}</p>
                    <p>You can still use the location list to find nearby waste facilities.</p>
                </div>
            `;
        }

        // Get user's current location with proper error handling
        function getUserLocation() {
            const gpsStatus = document.getElementById('gpsStatus');
            
            if (!navigator.geolocation) {
                console.log("Geolocation not supported");
                gpsStatus.innerHTML = '<i class="fas fa-exclamation-triangle" style="color:#f44336"></i><span>Geolocation not supported by browser</span>';
                showStatusMessage("Your browser doesn't support geolocation. Using default location.", "warning");
                return;
            }

            gpsStatus.innerHTML = '<i class="fas fa-satellite-dish loading"></i><span>Detecting your location...</span>';

            // Clear any existing watch
            if (geolocationWatchId !== null) {
                navigator.geolocation.clearWatch(geolocationWatchId);
            }

            // Use getCurrentPosition with a timeout
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    handleLocationSuccess(position);
                },
                (error) => {
                    handleLocationError(error);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000, // 10 seconds timeout
                    maximumAge: 0 // Don't use cached position
                }
            );

            // Also set up a watch for continuous updates
            geolocationWatchId = navigator.geolocation.watchPosition(
                (position) => {
                    handleLocationSuccess(position);
                },
                (error) => {
                    // Don't show error on watchPosition failure
                    console.log("WatchPosition error:", error);
                },
                {
                    enableHighAccuracy: false,
                    maximumAge: 30000, // 30 seconds
                    timeout: 5000
                }
            );
        }

        function handleLocationSuccess(position) {
            console.log("Location detected:", position.coords);
            
            const userLat = position.coords.latitude;
            const userLng = position.coords.longitude;
            userLocation = { lat: userLat, lng: userLng };

            // Update UI
            const gpsStatus = document.getElementById('gpsStatus');
            gpsStatus.innerHTML = '<i class="fas fa-check-circle" style="color:#4CAF50"></i><span>Location detected successfully</span>';

            // Get city name from coordinates
            getCityFromCoordinates(userLat, userLng)
                .then(cityName => {
                    updateLocationDisplay(userLocation, cityName);
                    showStatusMessage(`Location detected: ${cityName}`, "success");
                })
                .catch(error => {
                    console.log("Could not get city name:", error);
                    updateLocationDisplay(userLocation, "Your Current Location");
                    showStatusMessage("Location detected successfully", "success");
                });

            // Update map if available
            if (!mapError && map) {
                map.setCenter(userLocation);
                map.setZoom(14);

                // Update user marker
                if (userMarker) {
                    userMarker.setMap(null);
                }
                addUserMarker(userLocation, "Your Location");
            }

            // Find nearby facilities
            findNearbyFacilities();
        }

        function handleLocationError(error) {
            console.error("Geolocation error:", error);
            
            const gpsStatus = document.getElementById('gpsStatus');
            let errorMessage = "Could not detect location";
            
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage = "Location permission denied. Using default location.";
                    showStatusMessage("Please enable location services in your browser settings for accurate results.", "warning");
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = "Location information unavailable. Using default location.";
                    showStatusMessage("Location services are not available. Using default location.", "warning");
                    break;
                case error.TIMEOUT:
                    errorMessage = "Location request timed out. Using default location.";
                    showStatusMessage("Location detection took too long. Using default location.", "warning");
                    break;
                default:
                    errorMessage = "Unknown location error. Using default location.";
                    showStatusMessage("Could not detect your location. Using default location.", "warning");
                    break;
            }
            
            gpsStatus.innerHTML = `<i class="fas fa-exclamation-triangle" style="color:#FF9800"></i><span>${errorMessage}</span>`;
            
            // Use default location
            userLocation = defaultLocation;
            
            if (!mapError && map) {
                map.setCenter(userLocation);
                map.setZoom(12);
                
                if (userMarker) {
                    userMarker.setMap(null);
                }
                addUserMarker(userLocation, "Default Location (ATME College)");
            }
            
            updateLocationDisplay(userLocation, "Default Location (ATME College)");
            showAllFacilities();
        }

        // Get city name from coordinates using Nominatim
        async function getCityFromCoordinates(lat, lng) {
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=10&accept-language=en`
                );
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const data = await response.json();
                
                if (data.address) {
                    // Try to get city/town/village name
                    return data.address.city || 
                           data.address.town || 
                           data.address.village || 
                           data.address.county ||
                           "Unknown Location";
                }
                
                return "Unknown Location";
            } catch (error) {
                console.log("Error getting city name:", error);
                throw error;
            }
        }

        // Add user marker to map
        function addUserMarker(location, title) {
            if (mapError || !map) return;
            
            userMarker = new google.maps.Marker({
                position: location,
                map: map,
                title: title,
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 10,
                    fillColor: "#2196F3",
                    fillOpacity: 1,
                    strokeColor: "white",
                    strokeWeight: 2
                },
                animation: google.maps.Animation.DROP
            });
            
            // Add click listener
            userMarker.addListener('click', () => {
                infoWindow.setContent(`<div style="color: #333; padding: 10px;"><strong>${title}</strong><br>Lat: ${location.lat.toFixed(4)}<br>Lng: ${location.lng.toFixed(4)}</div>`);
                infoWindow.open(map, userMarker);
            });
        }

        // Update location display
        function updateLocationDisplay(location, locationName) {
            document.getElementById('coordinates').textContent = `Lat: ${location.lat.toFixed(4)}, Lng: ${location.lng.toFixed(4)}`;
            document.getElementById('cityName').textContent = locationName;
            updateLocationTime();
        }

        // Update location time
        function updateLocationTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            document.getElementById('locationTime').textContent = timeString;
        }

        // Find nearby facilities based on user location
        function findNearbyFacilities() {
            const loadingIndicator = document.getElementById('loadingIndicator');
            loadingIndicator.style.display = 'block';

            if (!userLocation) {
                userLocation = defaultLocation;
            }

            setTimeout(() => {
                // Calculate distances and sort by proximity
                const facilitiesWithDistance = wasteManagementData.map(facility => {
                    const distance = calculateDistance(
                        userLocation.lat, userLocation.lng,
                        facility.Latitude, facility.Longitude
                    );
                    return { ...facility, distance };
                });

                // Sort by distance
                facilitiesWithDistance.sort((a, b) => a.distance - b.distance);

                // Show the nearest 5-8 facilities
                const nearestFacilities = facilitiesWithDistance.slice(0, 8);

                // Clear existing markers
                if (!mapError) {
                    facilityMarkers.forEach(marker => marker.setMap(null));
                }
                facilityMarkers = [];

                // Add markers to map if available
                if (!mapError) {
                    nearestFacilities.forEach(facility => {
                        addFacilityMarker(facility);
                    });
                }

                // Update the locations list
                updateLocationsList(nearestFacilities);

                // Update stats
                updateStats(nearestFacilities);

                // Hide loading indicator
                loadingIndicator.style.display = 'none';
                
                showStatusMessage(`Found ${nearestFacilities.length} nearby waste facilities`, "success");
            }, 1500);
        }

        // Show all facilities (fallback when location is not available)
        function showAllFacilities() {
            const loadingIndicator = document.getElementById('loadingIndicator');
            loadingIndicator.style.display = 'block';

            setTimeout(() => {
                // Clear existing markers
                if (!mapError) {
                    facilityMarkers.forEach(marker => marker.setMap(null));
                }
                facilityMarkers = [];

                // Add all facility markers if map is available
                if (!mapError) {
                    wasteManagementData.forEach(facility => {
                        if (currentFilter === "all" || facility.WasteType === currentFilter) {
                            addFacilityMarker(facility);
                        }
                    });
                }

                // Update the locations list with all facilities
                const facilitiesWithDistance = wasteManagementData.map(facility => {
                    const distance = userLocation ? calculateDistance(
                        userLocation.lat, userLocation.lng,
                        facility.Latitude, facility.Longitude
                    ) : null;
                    return { ...facility, distance };
                });

                facilitiesWithDistance.sort((a, b) => {
                    if (a.distance === null) return 1;
                    if (b.distance === null) return -1;
                    return a.distance - b.distance;
                });

                updateLocationsList(facilitiesWithDistance.slice(0, 10));
                updateStats(facilitiesWithDistance);

                loadingIndicator.style.display = 'none';
                
                showStatusMessage(`Showing ${facilitiesWithDistance.length} waste facilities across India`, "info");
            }, 1500);
        }

        // Add a facility marker to the map
        function addFacilityMarker(facility) {
            // Skip if not matching current filter
            if (currentFilter !== "all" && facility.WasteType !== currentFilter) {
                return;
            }

            if (mapError || !map) return;

            // Determine icon color based on waste type
            let iconColor;
            switch (facility.WasteType) {
                case 'Plastic':
                    iconColor = '#FF9800';
                    break;
                case 'Organic':
                    iconColor = '#795548';
                    break;
                case 'E-Waste':
                    iconColor = '#9C27B0';
                    break;
                case 'Construction':
                    iconColor = '#607D8B';
                    break;
                case 'Hazardous':
                    iconColor = '#f44336';
                    break;
                default:
                    iconColor = '#4CAF50';
            }

            // Create marker using AdvancedMarkerElement if available
            let marker;
            
            try {
                if (window.google && google.maps && google.maps.marker && google.maps.marker.AdvancedMarkerElement) {
                    // Use AdvancedMarkerElement
                    marker = new google.maps.marker.AdvancedMarkerElement({
                        position: { lat: facility.Latitude, lng: facility.Longitude },
                        map: map,
                        title: facility.LandfillName,
                        content: createMarkerContent(iconColor, facility.RecyclingRate)
                    });
                } else {
                    // Fallback to traditional Marker
                    marker = new google.maps.Marker({
                        position: { lat: facility.Latitude, lng: facility.Longitude },
                        map: map,
                        title: facility.LandfillName,
                        icon: createMarkerIcon(iconColor, facility.RecyclingRate)
                    });
                }

                // Add click listener to show info
                if (marker.addListener) {
                    marker.addListener('click', function () {
                        showFacilityInfo(facility, marker);
                    });
                } else {
                    // For AdvancedMarkerElement
                    marker.addListener('click', () => {
                        showFacilityInfo(facility, marker);
                    });
                }

                facilityMarkers.push(marker);
            } catch (error) {
                console.error("Error creating marker:", error);
            }
        }

        // Create marker content for AdvancedMarkerElement
        function createMarkerContent(color, recyclingRate) {
            const container = document.createElement('div');
            container.style.width = '40px';
            container.style.height = '40px';
            container.style.borderRadius = '50%';
            container.style.backgroundColor = color;
            container.style.border = '2px solid white';
            container.style.boxShadow = '0 2px 5px rgba(0,0,0,0.3)';
            container.style.display = 'flex';
            container.style.alignItems = 'center';
            container.style.justifyContent = 'center';
            container.style.color = 'white';
            container.style.fontWeight = 'bold';
            container.style.fontSize = '12px';
            
            const innerCircle = document.createElement('div');
            innerCircle.style.width = '12px';
            innerCircle.style.height = '12px';
            innerCircle.style.borderRadius = '50%';
            innerCircle.style.backgroundColor = recyclingRate > 60 ? '#4CAF50' : recyclingRate > 40 ? '#FF9800' : '#f44336';
            
            container.appendChild(innerCircle);
            return container;
        }

        // Create marker icon for traditional Marker
        function createMarkerIcon(color, recyclingRate) {
            const svg = `
                <svg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="20" cy="20" r="18" fill="${color}" stroke="white" stroke-width="2"/>
                    <circle cx="20" cy="20" r="8" fill="${recyclingRate > 60 ? '#4CAF50' : recyclingRate > 40 ? '#FF9800' : '#f44336'}"/>
                </svg>
            `;
            
            return {
                url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(svg),
                scaledSize: new google.maps.Size(40, 40),
                anchor: new google.maps.Point(20, 20)
            };
        }

        // Show facility info in info window
        function showFacilityInfo(facility, marker) {
            const contentString = `
                <div style="color: #333; max-width: 250px; font-family: Arial, sans-serif;">
                    <div style="background: #2E7D32; color: white; padding: 10px; border-radius: 5px 5px 0 0; margin: -8px -8px 10px -8px;">
                        <h3 style="margin: 0; font-size: 14px;">${facility.LandfillName}</h3>
                    </div>
                    <div style="padding: 5px;">
                        <p style="margin: 5px 0; font-size: 12px;"><strong> City:</strong> ${facility.City}</p>
                        <p style="margin: 5px 0; font-size: 12px;"><strong> Waste Type:</strong> ${facility.WasteType}</p>
                        <p style="margin: 5px 0; font-size: 12px;"><strong> Waste Generated:</strong> ${facility.WasteGenerated} tons/day</p>
                        <p style="margin: 5px 0; font-size: 12px;"><strong> Recycling Rate:</strong> ${facility.RecyclingRate}%</p>
                        <p style="margin: 5px 0; font-size: 12px;"><strong> Disposal Method:</strong> ${facility.DisposalMethod}</p>
                        <p style="margin: 5px 0; font-size: 12px;"><strong> Capacity:</strong> ${facility.LandfillCapacity.toLocaleString()} tons</p>
                        <p style="margin: 5px 0; font-size: 12px;"><strong> Distance:</strong> ${facility.distance ? facility.distance.toFixed(2) + ' km' : 'Unknown'}</p>
                    </div>
                </div>
            `;

            infoWindow.setContent(contentString);
            infoWindow.open(map, marker);
        }

        // Update the locations list in the sidebar
        function updateLocationsList(facilities) {
            const locationsList = document.getElementById('locationsList');
            
            if (!facilities || facilities.length === 0) {
                locationsList.innerHTML = '<div class="location-card"><div class="location-details">No facilities found matching your criteria.</div></div>';
                return;
            }

            locationsList.innerHTML = '';

            facilities.forEach(facility => {
                const card = document.createElement('div');
                card.className = 'location-card';
                card.dataset.id = facility.LandfillName;

                let typeClass = 'type-dustbin';
                let typeIcon = 'trash';

                // Determine waste type styling
                switch (facility.WasteType) {
                    case 'Plastic':
                        typeClass = 'type-recycling';
                        typeIcon = 'recycle';
                        break;
                    case 'Organic':
                        typeClass = 'type-compost';
                        typeIcon = 'leaf';
                        break;
                    case 'E-Waste':
                        typeClass = 'type-center';
                        typeIcon = 'laptop';
                        break;
                    case 'Construction':
                        typeClass = 'type-dustbin';
                        typeIcon = 'hard-hat';
                        break;
                    case 'Hazardous':
                        typeClass = 'type-center';
                        typeIcon = 'exclamation-triangle';
                        break;
                }

                // Determine status based on recycling rate
                let statusClass = 'status-available';
                const recyclingRate = facility.RecyclingRate;
                if (recyclingRate > 60) {
                    statusClass = 'status-available';
                } else if (recyclingRate > 40) {
                    statusClass = 'status-maintenance';
                } else {
                    statusClass = 'status-full';
                }

                card.innerHTML = `
                    <div class="location-card-header">
                        <div class="location-name">
                            <i class="fas fa-${typeIcon}"></i>
                            ${facility.LandfillName}
                        </div>
                        ${facility.distance ? `<span class="location-distance-badge">${facility.distance.toFixed(2)} km</span>` : ''}
                    </div>
                    <div class="location-details">
                        <i class="fas fa-map-marker-alt"></i> ${facility.City}
                    </div>
                    <div class="location-details">
                        <i class="fas fa-trash"></i> ${facility.WasteGenerated} tons/day
                    </div>
                    <div>
                        <span class="location-type ${typeClass}">${facility.WasteType}</span>
                        <span class="location-status ${statusClass}">${facility.RecyclingRate}% recycled</span>
                    </div>
                `;

                // Add click listener to center map on this facility if map is available
                card.addEventListener('click', function () {
                    if (!mapError && map) {
                        map.setCenter({ lat: facility.Latitude, lng: facility.Longitude });
                        map.setZoom(16);

                        // Find and trigger the corresponding marker
                        const marker = facilityMarkers.find(m => {
                            const pos = m.position || m.getPosition();
                            return pos.lat() === facility.Latitude && pos.lng() === facility.Longitude;
                        });

                        if (marker) {
                            showFacilityInfo(facility, marker);
                        }
                    }

                    // Highlight the card
                    document.querySelectorAll('.location-card').forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                });

                locationsList.appendChild(card);
            });
        }

        // Update statistics
        function updateStats(facilities) {
            const nearby = facilities.filter(f => f.distance && f.distance < 5).length;
            document.getElementById('nearbyFacilities').textContent = nearby;
            document.getElementById('totalFacilities').textContent = wasteManagementData.length;
            
            // Count unique cities
            const uniqueCities = [...new Set(wasteManagementData.map(item => item.City))];
            document.getElementById('citiesCount').textContent = uniqueCities.length;
        }

        // Apply filter
        function applyFilter(type) {
            currentFilter = type;

            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.dataset.type === type) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            // Clear existing markers
            if (!mapError) {
                facilityMarkers.forEach(marker => {
                    if (marker.setMap) marker.setMap(null);
                });
            }
            facilityMarkers = [];

            // Add filtered markers
            wasteManagementData.forEach(facility => {
                if (currentFilter === "all" || facility.WasteType === currentFilter) {
                    addFacilityMarker(facility);
                }
            });

            // Update locations list
            if (userLocation) {
                const facilitiesWithDistance = wasteManagementData.map(facility => {
                    const distance = calculateDistance(
                        userLocation.lat, userLocation.lng,
                        facility.Latitude, facility.Longitude
                    );
                    return { ...facility, distance };
                });

                facilitiesWithDistance.sort((a, b) => a.distance - b.distance);
                const nearestFacilities = facilitiesWithDistance.slice(0, 8);
                updateLocationsList(nearestFacilities);
                updateStats(nearestFacilities);
            } else {
                updateLocationsList(wasteManagementData);
                updateStats(wasteManagementData);
            }
            
            showStatusMessage(`Filter applied: ${type === 'all' ? 'All waste types' : type}`, "info");
        }

        // Calculate distance between two coordinates (Haversine formula)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Earth's radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            const distance = R * c;
            return distance;
        }

        // Show status message
        function showStatusMessage(message, type = "info") {
            const statusMessage = document.getElementById('statusMessage');
            
            let className, icon;
            switch(type) {
                case "success":
                    className = "success-message";
                    icon = "check-circle";
                    break;
                case "warning":
                    className = "warning-message";
                    icon = "exclamation-triangle";
                    break;
                case "error":
                    className = "error-message";
                    icon = "times-circle";
                    break;
                default:
                    className = "success-message";
                    icon = "info-circle";
            }
            
            statusMessage.className = className;
            statusMessage.innerHTML = `<i class="fas fa-${icon}"></i> ${message}`;
            statusMessage.style.display = 'flex';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }

        // Create background animation
        function createBackgroundAnimation() {
            const backgroundAnimation = document.getElementById('backgroundAnimation');

            // Create bubbles
            for (let i = 0; i < 15; i++) {
                const bubble = document.createElement('div');
                bubble.classList.add('bubble');
                const size = Math.random() * 60 + 20;
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                bubble.style.left = `${Math.random() * 100}%`;
                bubble.style.top = `${Math.random() * 100}%`;
                bubble.style.animationDelay = `${Math.random() * 15}s`;
                backgroundAnimation.appendChild(bubble);
            }

            // Create leaves
            for (let i = 0; i < 10; i++) {
                const leaf = document.createElement('div');
                leaf.classList.add('leaf');
                leaf.innerHTML = '<i class="fas fa-leaf"></i>';
                leaf.style.left = `${Math.random() * 100}%`;
                leaf.style.animationDelay = `${Math.random() * 20}s`;
                backgroundAnimation.appendChild(leaf);
            }
        }

        // Initialize the page when loaded
        document.addEventListener('DOMContentLoaded', function () {
            createBackgroundAnimation();

            // Set up button event listeners
            document.getElementById('refreshLocationBtn').addEventListener('click', getUserLocation);
            document.getElementById('findNearestBtn').addEventListener('click', findNearbyFacilities);

            // Set up filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    applyFilter(this.dataset.type);
                });
            });

            // Update time every second
            setInterval(updateLocationTime, 1000);

            // Add error handler for Google Maps
            window.gm_authFailure = function () {
                console.error("Google Maps authentication failed");
                showMapError("Google Maps authentication failed. Please check your API key.");
            };
            
            // Handle Google Maps API errors
            window.onerror = function(msg, url, lineNo, columnNo, error) {
                if (msg.includes('google') || msg.includes('maps')) {
                    console.error("Google Maps error:", msg);
                }
                return false;
            };
        });
    </script>
</body>

</html>
